<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dropzone X</title>
    <link rel="stylesheet" href="/static/css/app.css" />
  </head>
  <body data-active-view="{{ active_view or 'play' }}">
    <div class="app-shell">
      <header class="topbar">
        <div class="brand">
          <span class="brand-mark">Δ</span>
          <span class="brand-title">Dropzone X</span>
        </div>
        <nav class="primary-nav">
          <a class="nav-btn {% if active_view == 'play' %}active{% endif %}" data-view="play" href="/?view=play">Gioca</a>
          <a class="nav-btn {% if active_view == 'pass' %}active{% endif %}" data-view="pass" href="/?view=pass">Battle Pass</a>
          <a class="nav-btn {% if active_view == 'locker' %}active{% endif %}" data-view="locker" href="/?view=locker">Armadietto</a>
          <a class="nav-btn {% if active_view == 'shop' %}active{% endif %}" data-view="shop" href="/?view=shop">Negozio</a>
          <a class="nav-btn {% if active_view == 'profile' %}active{% endif %}" data-view="profile" href="/?view=profile">Profilo</a>
        </nav>
        <div class="currencies">
          <span class="currency">⛁ <strong id="currency-credits">{{ lobby.currencies.credits }}</strong></span>
          <span class="currency">⚡ <strong id="currency-flux">{{ lobby.currencies.flux }}</strong></span>
          <span class="currency">◇ <strong id="currency-tokens">{{ lobby.currencies.tokens }}</strong></span>
        </div>
      </header>

      <main class="layout">
        <section class="view view-play" data-view-section="play" {% if active_view != 'play' %}hidden{% endif %}>
          <div class="play-grid">
            <section class="hero-card">
              <div class="hero-portrait">
                <div class="hero-thumbnail"></div>
              </div>
              <div class="hero-info">
                <h1 id="hero-name">{{ lobby.hero.displayName }}</h1>
                <p class="title" id="hero-title">{{ lobby.hero.title }}</p>
                <p class="level">Livello <span id="hero-level">{{ lobby.hero.level }}</span></p>
                <div class="xp-bar">
                  <div id="xp-fill" class="xp-fill" style="width: {{ lobby.hero.xpProgress * 100 }}%"></div>
                </div>
                <div class="loadout-grid">
                  <div>
                    <span class="label">Primaria</span>
                    <strong id="loadout-primary">{{ lobby.hero.loadout.primary }}</strong>
                  </div>
                  <div>
                    <span class="label">Secondaria</span>
                    <strong id="loadout-secondary">{{ lobby.hero.loadout.secondary }}</strong>
                  </div>
                  <div>
                    <span class="label">Gadget</span>
                    <strong id="loadout-gadget">{{ lobby.hero.loadout.gadget }}</strong>
                  </div>
                </div>
                <p class="mode-highlight">Modalità consigliata: <strong id="highlight-mode">{{ lobby.dailyHighlight.mode }}</strong> · <span id="highlight-map">{{ lobby.dailyHighlight.map }}</span></p>
                <div class="matchmaking-card">
                  <p id="queue-status">Pronto a lanciarti.</p>
                  <button id="play-button" class="cta">Avvia Matchmaking</button>
                  <button id="cancel-button" class="ghost" hidden>Annulla</button>
                </div>
              </div>
            </section>
            <div class="play-sidebar">
              <section class="activity-panel">
                <h2>Stato rete</h2>
                <ul class="activity-grid">
                  <li>
                    <span class="label">Giocatori online</span>
                    <strong id="stat-online">{{ lobby.activity.onlinePlayers }}</strong>
                  </li>
                  <li>
                    <span class="label">In ricerca</span>
                    <strong id="stat-searching">{{ lobby.activity.searching }}</strong>
                  </li>
                  <li>
                    <span class="label">Match attivi</span>
                    <strong id="stat-active">{{ lobby.activity.activeMatches }}</strong>
                  </li>
                </ul>
                <h2>Squadra</h2>
                <div id="squad" class="squad-list">
                  <p>Nessuna sessione attiva.</p>
                </div>
              </section>
              <section class="panel news-panel">
                <h2>Notizie</h2>
                <h3 id="news-headline">{{ lobby.news.headline }}</h3>
                <p id="news-blurb">{{ lobby.news.blurb }}</p>
              </section>
            </div>
          </div>
        </section>

        <section class="panel pass-panel" data-view-section="pass" {% if active_view != 'pass' %}hidden{% endif %}>
          <header class="panel-header">
            <div>
              <h2>Battle Pass</h2>
              <p>Livello <strong id="pass-level">{{ lobby.battlePass.level }}</strong></p>
            </div>
            <div class="pass-progress">
              <div class="pass-progress-bar">
                <span id="pass-progress" style="width: {{ lobby.battlePass.progress * 100 }}%"></span>
              </div>
              <span class="pass-progress-label" id="pass-progress-label">{{ (lobby.battlePass.progress * 100)|round(0) }}% completato</span>
            </div>
          </header>
          <p class="panel-subtitle">Completa missioni giornaliere per ottenere XP aggiuntiva e sbloccare la prossima ricompensa.</p>
          <ul id="pass-track" class="pass-track">
            {% for reward in lobby.battlePass.rewards %}
            <li>
              <span class="label">Tier {{ reward.tier }}</span>
              <strong>{{ reward.reward }}</strong>
            </li>
            {% endfor %}
          </ul>
        </section>

        <section class="panel locker-panel" data-view-section="locker" {% if active_view != 'locker' %}hidden{% endif %}>
          <h2>Armadietto</h2>
          <p class="panel-subtitle">Personalizza l'aspetto del tuo operatore con skin, armi e animazioni dedicate.</p>
          <div class="locker-layout">
            <aside class="locker-summary">
              <article class="locker-card">
                <figure class="locker-thumb">
                  <img id="locker-outfit-thumb" src="{{ lobby.cosmetics.equippedOutfit.thumbnailUrl }}" alt="Skin equipaggiata" />
                </figure>
                <div class="locker-card-body">
                  <span class="label">Skin equipaggiata</span>
                  <strong id="locker-outfit">{{ lobby.locker.outfit }}</strong>
                  <p id="locker-outfit-rarity" class="rarity-pill">{{ lobby.cosmetics.equippedOutfit.rarity }}</p>
                  <ul class="locker-loadout">
                    <li><span class="label">Zaino</span><strong id="locker-backbling">{{ lobby.locker.backbling }}</strong></li>
                    <li><span class="label">Piccone</span><strong id="locker-pickaxe">{{ lobby.locker.pickaxe }}</strong></li>
                    <li><span class="label">Deltaplano</span><strong id="locker-glider">{{ lobby.locker.glider }}</strong></li>
                  </ul>
                </div>
              </article>
              <article class="locker-card">
                <figure class="locker-thumb">
                  <img id="locker-weapon-thumb" src="{{ lobby.cosmetics.equippedWeaponSkin.thumbnailUrl }}" alt="Skin arma" />
                </figure>
                <div class="locker-card-body">
                  <span class="label">Skin arma</span>
                  <strong id="locker-wrap">{{ lobby.locker.wrap }}</strong>
                  <p id="locker-wrap-bonus" class="rarity-pill">+{{ (lobby.cosmetics.equippedWeaponSkin.powerModifier * 100)|round(1) }}% potenza</p>
                </div>
              </article>
              <article class="locker-card">
                {% set equipped_animation = lobby.cosmetics.animationSets | selectattr('id', 'equalto', lobby.cosmetics.equippedOutfit.animationSetId) | list | first %}
                <div class="locker-card-body">
                  <span class="label">Set animazioni</span>
                  <strong id="animation-name">{{ equipped_animation.name if equipped_animation else 'N/D' }}</strong>
                  <p id="animation-description">{{ equipped_animation.description if equipped_animation else 'Configura un set animazioni per applicare blending dinamico in partita.' }}</p>
                </div>
              </article>
              <div class="locker-emotes">
                <h3>Emote rapidi</h3>
                <ul id="locker-emotes">
                  {% for emote in lobby.locker.emotes %}
                  <li>{{ emote }}</li>
                  {% endfor %}
                </ul>
              </div>
            </aside>
            <div class="locker-management">
              <section class="cosmetic-library">
                <div class="section-heading">
                  <h3>Skin disponibili</h3>
                  <span id="outfit-count" class="count-pill">{{ lobby.cosmetics.outfits | length }}</span>
                </div>
                <ul id="outfit-list" class="cosmetic-list">
                  {% for outfit in lobby.cosmetics.outfits %}
                  <li class="cosmetic-item {% if lobby.cosmetics.equippedOutfit.id == outfit.id %}equipped{% endif %}" data-outfit-id="{{ outfit.id }}">
                    <img src="{{ outfit.thumbnailUrl }}" alt="{{ outfit.name }}" />
                    <div class="cosmetic-details">
                      <strong>{{ outfit.name }}</strong>
                      <span>{{ outfit.rarity }}</span>
                    </div>
                    <button type="button" class="equip-btn" data-equip-outfit="{{ outfit.id }}">Equipaggia</button>
                  </li>
                  {% endfor %}
                </ul>
              </section>
              <section class="cosmetic-library">
                <div class="section-heading">
                  <h3>Skin arma</h3>
                  <span id="weapon-count" class="count-pill">{{ lobby.cosmetics.weaponSkins | length }}</span>
                </div>
                <ul id="weapon-skin-list" class="cosmetic-list">
                  {% for skin in lobby.cosmetics.weaponSkins %}
                  <li class="cosmetic-item {% if lobby.cosmetics.equippedWeaponSkin.id == skin.id %}equipped{% endif %}" data-weapon-id="{{ skin.id }}">
                    <img src="{{ skin.thumbnailUrl }}" alt="{{ skin.name }}" />
                    <div class="cosmetic-details">
                      <strong>{{ skin.name }}</strong>
                      <span>{{ skin.rarity }}</span>
                    </div>
                    <button type="button" class="equip-btn" data-equip-weapon="{{ skin.id }}">Equipaggia</button>
                  </li>
                  {% endfor %}
                </ul>
              </section>
              <section class="cosmetic-forms">
                <div class="form-card">
                  <h3>Importa nuova skin</h3>
                  <form id="outfit-import-form" class="cosmetic-form">
                    <label>Nome
                      <input type="text" name="name" required />
                    </label>
                    <label>URL modello glTF
                      <input type="url" name="modelUrl" required placeholder="https://.../model.glb" />
                    </label>
                    <label>Anteprima (opzionale)
                      <input type="url" name="thumbnailUrl" placeholder="https://.../preview.jpg" />
                    </label>
                    <label>Set animazioni
                      <select name="animationSetId" id="outfit-animation-set">
                        {% for animation in lobby.cosmetics.animationSets %}
                        <option value="{{ animation.id }}" {% if lobby.cosmetics.equippedOutfit.animationSetId == animation.id %}selected{% endif %}>{{ animation.name }}</option>
                        {% endfor %}
                      </select>
                    </label>
                    <button type="submit" class="cta">Importa skin</button>
                  </form>
                </div>
                <div class="form-card">
                  <h3>Importa skin arma</h3>
                  <form id="weapon-import-form" class="cosmetic-form">
                    <label>Nome
                      <input type="text" name="name" required />
                    </label>
                    <label>Texture o materiale
                      <input type="url" name="textureUrl" required placeholder="https://.../texture.jpg" />
                    </label>
                    <label>Anteprima (opzionale)
                      <input type="url" name="thumbnailUrl" placeholder="https://.../preview.jpg" />
                    </label>
                    <label>Potenziamento (%)
                      <input type="number" step="0.1" min="0" max="5" name="powerModifier" value="2.0" />
                    </label>
                    <button type="submit" class="ghost">Importa skin arma</button>
                  </form>
                </div>
              </section>
            </div>
          </div>
        </section>

        <section class="panel shop-panel" data-view-section="shop" {% if active_view != 'shop' %}hidden{% endif %}>
          <h2>Negozio</h2>
          <div class="shop-columns">
            <div>
              <h3>In evidenza</h3>
              <ul id="shop-featured" class="shop-list">
                {% for item in lobby.shop.featured %}
                <li>
                  <div>
                    <strong>{{ item.name }}</strong>
                    <span class="rarity">{{ item.rarity }}</span>
                  </div>
                  <span class="price">{{ item.price }} ⛁</span>
                </li>
                {% endfor %}
              </ul>
            </div>
            <div>
              <h3>Oggetti giornalieri</h3>
              <ul id="shop-daily" class="shop-list">
                {% for item in lobby.shop.daily %}
                <li>
                  <div>
                    <strong>{{ item.name }}</strong>
                    <span class="rarity">{{ item.rarity }}</span>
                  </div>
                  <span class="price">{{ item.price }} ⛁</span>
                </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </section>

        <section class="panel profile-panel" data-view-section="profile" {% if active_view != 'profile' %}hidden{% endif %}>
          <h2>Profilo</h2>
          <p class="panel-subtitle">Monitoraggio prestazioni Dropzone X.</p>
          <ul class="profile-stats">
            <li>
              <span class="label">Partite giocate</span>
              <strong id="profile-matches">{{ lobby.profile.matchesPlayed }}</strong>
            </li>
            <li>
              <span class="label">Vittorie</span>
              <strong id="profile-wins">{{ lobby.profile.wins }}</strong>
            </li>
            <li>
              <span class="label">Win Rate</span>
              <strong id="profile-winrate">{{ lobby.profile.winRate }}%</strong>
            </li>
            <li>
              <span class="label">Rapporto K/O</span>
              <strong id="profile-kdr">{{ lobby.profile.kdr }}</strong>
            </li>
            <li>
              <span class="label">Tempo di gioco</span>
              <strong id="profile-time">{{ (lobby.profile.timePlayedMinutes / 60)|round(1) }} h</strong>
            </li>
          </ul>
        </section>
      </main>

      <footer class="footer">
        <span>Backend online · matchmaking automatizzato con bot se necessario.</span>
      </footer>
    </div>

    <script id="initial-data" type="application/json">{{ lobby | tojson }}</script>
    <script src="/static/js/app.js" type="module"></script>
  </body>
</html>
